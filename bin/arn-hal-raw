#!/usr/bin/lua
-- ARN Device HAL Layer
-- Donot filter anything
-- Provide unified commands
-- by Qige <qigezhao@gmail.com>

local gws_hal = require 'arn.hal_raw'
local sfmt = string.format

local arg_key = tostring(arg[1])
local arg_val = tostring(arg[2])

local function help()
  print "usage: "
  print "  arn-hal-raw [c|channel|r|region|rfinfo|p|txpower|b|chanbw]"
  print "  arn-hal-raw [c|channel|r|region|rfinfo|p|txpower|b|chanbw] [value]"
end

-- print each item from HAL
local function display(key)
    local gws_raw = gws_hal.HAL_GET_RT()
    local result = ''
    for i,v in pairs(gws_raw) do
        if (result ~= '') then result = result .. '\n' end
        result = result .. sfmt("%s=%s", i, v)
    end
    return result
end

-- FIXME: add all common commands
if (arg_key ~= 'nil') then
  if (arg_val ~= 'nil') then
    print(sfmt("arn-hal-raw: set %s=%s", arg_key, arg_val))
    gws_hal.HAL_SET_RT(arg_key, arg_val)
  else
    print(sfmt("> %s", arg_key))
    print(display(arg_key))
  end
else
  help()
end